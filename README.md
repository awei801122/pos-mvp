# 自助點餐 POS 系統

## 專案概述

本專案旨在開發一套自助點餐 POS 系統,為餐飲業者提供一個高效、易用的點餐管理解決方案。該系統主要面向中小型餐廳、咖啡廳等商家,幫助他們實現:

- 無人點餐: 顧客可以通過前台觸控螢幕自助點餐,減少人工成本。
- 訂單管理: 後台可以高效管理訂單,包括接單、出餐、訂單修改等。
- 叫號系統: 系統支援叫號功能,顧客取餐更方便。
- 報表統計: 自動生成日結報表,幫助商家掌握經營數據。
- 菜單管理: 商家可以輕鬆設定和調整菜單內容,包括菜品、價格、選項等。

本系統採用前後端分離架構,前端使用 Electron 構建跨平台的桌面應用程式,支援 Windows 和 macOS 系統。後端使用 PHP 搭建伺服器,負責資料處理和存儲。

主要功能模組包括:

1. 使用者登入/登出
2. 前台點餐界面
3. 後台訂單管理
4. 叫號排隊系統
5. 菜單管理
6. 報表統計
7. 系統設定 

## 安裝與執行

### 前置需求

- 作業系統: Windows 7+ / macOS 10.12+
- Node.js: v14.x+
- PHP: 7.4+
- Composer: 2.x+




### 安裝依賴項

在專案根目錄下,運行以下命令安裝前端依賴項:

```bash
npm install
```

在 `kiosk/` 目錄下,運行以下命令安裝後端依賴項:

```bash
composer install
```

### 啟動專案

首先,啟動後端 API 伺服器。在 `kiosk/` 目錄下運行:

```bash
php -S 0.0.0.0:8000
```

然後,啟動前端開發伺服器。在專案根目錄下運行:

```bash
npm start
```

現在,你可以在瀏覽器中訪問 `http://localhost:3000` 來使用本應用程式了。

### 常見問題

1. Q: 在 Windows 上運行 `npm install` 時遇到了許可權錯誤怎麼辦?
   A: 請以管理員身份運行命令提示字元,然後再次執行 `npm install` 命令。

2. Q: 執行 `php -S 0.0.0.0:8000` 時出現了 "PHP 不是內部或外部命令" 的錯誤。
   A: 請檢查你是否已經正確安裝了 PHP,並且將 PHP 執行檔所在目錄添加到了系統的 PATH 環境變數中。

3. Q: 在 macOS 上執行 `npm start` 時遇到了 "gyp: No Xcode or CLT version detected!" 錯誤。  
   A: 請先安裝 Xcode Command Line Tools。在終端機中執行 `xcode-select --install` 即可。 

## 系統架構

### 前端技術棧

我們選擇使用 Electron 作為前端框架,主要考慮到以下幾點:

- Electron 允許我們使用 Web 技術(HTML, CSS, JavaScript)來構建跨平台的桌面應用程式,學習成本相對較低。
- Electron 提供了豐富的 API,可以方便地訪問本地資源,如檔案系統、系統通知等,這對於我們的應用程式非常重要。
- Electron 有著活躍的社群和完善的文件,可以幫助我們快速解決開發中遇到的問題。
- 使用 Electron,我們可以輕鬆地將 Web 應用程式打包成可執行檔,簡化了部署和分發的流程。

### 後端技術棧

在後端,我們決定使用 PHP,主要基於以下考量:

- PHP 是一種成熟、穩定的伺服器端語言,有著廣泛的應用和豐富的生態系統。
- PHP 特別適合 Web 開發,提供了很多內建的 Web 相關功能,如 Session 管理、表單處理等。
- PHP 有著優秀的效能,尤其是在處理併發請求時。這對於我們的點餐系統非常重要。
- 團隊成員普遍具備 PHP 開發經驗,這將有助於專案的順利進行。

### 資料庫選型

對於資料庫,我們計劃使用 MySQL,主要原因如下:

- MySQL 是一種廣泛使用的開源關聯式資料庫管理系統,具有高可靠性、高效能、可擴展等特點。
- MySQL 支援 ACID 事務,可以保證資料的完整性和一致性,這對於訂單、支付等關鍵業務非常重要。
- MySQL 有著豐富的資料類型和強大的 SQL 查詢功能,可以滿足我們對資料儲存和檢索的需求。
- 團隊在 MySQL 的使用和優化方面有著豐富的經驗,這將有助於我們構建高品質的資料庫層。

### 部署拓撲

我們計劃採用以下的部署拓撲:

- 開發環境: 每個開發者在自己的本地機器上搭建完整的開發環境,包括前端、後端和資料庫。
- 測試環境: 搭建一套與生產環境配置相近的測試環境,用於集成測試和使用者驗收測試。
- 生產環境: 前端應用程式打包成可執行檔,在客戶的機器上運行;後端 API 伺服器和資料庫部署在雲端伺服器上,通過網路進行通信。 

+------------------+         +----------------+         +-----------------+
|                  |         |                |         |                 |
|  Electron 前端   |  <----> |   PHP 後端     |  <----> |   MySQL 資料庫  |
|                  |         |                |         |                 |
+------------------+         +----------------+         +-----------------+
        |                                                         |
        |                                                         |
        v                                                         v
  +------------+                                           +-------------+
  |            |                                           |             |
  | 本地資源   |                                           | 雲端伺服器  |
  |            |                                           |             |
  +------------+                                           +-------------+ 

## 專案結構

本專案的目錄結構如下:

- `README.md`: 專案說明文件,包含專案概述、安裝指南、使用方法等。
- `package.json`: 專案的設定檔,記錄了專案的基本資訊、依賴項、指令碼等。
- `electron/`: Electron 相關程式碼目錄
  - `main.js`: Electron 應用程式的主程序。
  - `preload.js`: Electron 的預載腳本。
- `kiosk/`: 後端 PHP 程式碼目錄
  - `index.php`: 後端的入口檔案,所有的請求都會經過這裡進行路由分發。
  - `login/`: 登入系統相關檔案
    - `login.php`: 處理使用者登入登出的 API。
  - `reports/`: 報表相關檔案
    - `reports.php`: 生成各種報表的 API。
  - `inventory/`: 庫存管理相關檔案
    - `inventory.php`: 處理庫存相關操作的 API。
  - `order/`: 訂單相關檔案
    - `save_order.php`: 處理訂單保存的 API。
  - `admin/`: 後台管理相關檔案
    - `kitchen.php`: 處理廚房管理的 API。
    - `queue.php`: 處理隊列管理的 API。
  - `data/`: 資料檔案目錄
    - `config.json`: 系統設定檔案。
    - `menu.json`: 菜單資料檔案。
    - `queue.json`: 隊列資料檔案。
  - `includes/`: 通用函式庫
    - `functions.php`: 通用輔助函數。
    - `db.php`: 資料庫操作函數。
    - `auth.php`: 認證相關函數。
  - `logs/`: 日誌檔案目錄
  - `assets/`: 資源檔案目錄
    - `js/`: JavaScript 檔案。
    - `css/`: CSS 樣式表。
    - `img/`: 圖片資源。
    - `sounds/`: 音效檔案。
- `ui/`: 前端 UI 程式碼目錄
  - `login.html`: 登入頁面。
  - `reports.html`: 報表頁面。
  - `inventory.html`: 庫存管理頁面。
  - `order.html`: 訂單頁面。
  - `admin.html`: 後台管理頁面。
  - `config-ui.html`: 設定頁面。
  - `css/`: CSS 樣式表目錄。
  - `js/`: JavaScript 檔案目錄
    - `login.js`: 登入頁面的交互邏輯。
    - `reports.js`: 報表頁面的交互邏輯。
    - `inventory.js`: 庫存頁面的交互邏輯。
    - `order.js`: 訂單頁面的交互邏輯。
    - `admin.js`: 後台管理頁面的交互邏輯。
  - `img/`: 圖片資源目錄。
- `docs/`: 專案文件目錄
  - `mac伺服器啟動.md`: 在 macOS 上啟動伺服器的說明。
  - `上傳方式github`: 如何將專案上傳到 GitHub 的指南。
- `node_modules/`: Node.js 的依賴項目錄
- `.gitignore`: Git 忽略規則檔案
- `.editorconfig`: 編輯器設定檔案
- `.eslintrc.json`: ESLint 設定檔案
- `.prettierrc`: Prettier 設定檔案
- `vite.config.ts`: Vite 設定檔案
- `tsconfig.json`: TypeScript 設定檔案

## 開發指南

為了確保專案的程式碼品質和協作效率,我們制定了以下開發規範,所有參與本專案的開發者都需要遵守。

### 分支管理

我們使用 Git 進行版本控制,並採用以下分支管理策略:

- `master` 分支:穩定版本分支,用於發佈到生產環境。只能從 `develop` 分支合併,不能直接提交。
- `develop` 分支:開發分支,用於整合各個功能分支的程式碼。只能從 `feature/` 分支合併,不能直接提交。
- `feature/` 分支:功能開發分支,從 `develop` 分支建立,用於開發新功能。功能完成後合併回 `develop` 分支並刪除。
- `bugfix/` 分支:問題修復分支,從 `develop` 分支建立,用於修復 BUG。修復完成後合併回 `develop` 分支並刪除。
- `hotfix/` 分支:緊急修復分支,從 `master` 分支建立,用於修復線上問題。修復完成後合併回 `master` 和 `develop` 分支並刪除。

### 程式碼風格

我們遵循以下程式碼風格規範:

- 縮排:使用 4 個空格,不使用 Tab。
- 變數命名:使用語義化的英文單詞,採用小駝峰式命名法(`camelCase`)。
- 函式命名:使用語義化的英文單詞,採用小寫加下劃線的命名法(`snake_case`)。
- 類命名:使用語義化的英文單詞,採用大駝峰式命名法(`PascalCase`)。
- 常量命名:全部使用大寫字母,單詞之間用下劃線分隔(`SNAKE_CASE`)。
- 每行程式碼不超過 80 個字元。
- 運算子前後、逗號後、大括號前後要加空格。
- 控制語句的左括號前要加空格。
- 程式碼塊的左括號不換行,右括號獨占一行。

### 提交訊息

每次提交程式碼時,都需要撰寫清晰的提交訊息,說明本次提交的內容。提交訊息的格式如下:

```
<type>: <subject>

<body>

<footer>
```

其中:

- `type` 表示提交的類型,可以是以下幾種:
  - `feat`:新功能
  - `fix`:修復 BUG
  - `docs`:文件修改  
  - `style`:程式碼格式修改
  - `refactor`:重構程式碼
  - `test`:添加或修改測試
  - `chore`:構建或輔助工具的修改
- `subject` 是一句話簡要描述提交的內容,不超過 50 個字元。
- `body` 是更詳細的描述,可以分成多行,每行不超過 72 個字元。
- `footer` 是一些備註,通常用於關聯 Issue 或者說明不兼容變更。

示例:

```
feat: 添加使用者登入功能

- 在首頁添加登入按鈕
- 建立登入頁面,包含使用者名和密碼輸入框,以及登入按鈕
- 建立使用者資料表,儲存使用者資訊
- 實現使用者登入後台邏輯,驗證使用者名和密碼
- 登入成功後跳轉到使用者中心頁面

Close #123
```

### 程式碼審查

我們通過 Pull Request 進行程式碼審查,過程如下:

1. 開發者在本地開發完成後,push 到自己的遠端分支。
2. 在 GitLab 上發起一個 Pull Request,選擇要合併到的目標分支(通常是 `develop` 分支)。
3. 項目維護者 Review 程式碼,提出修改意見。
4. 開發者根據意見進行修改,然後重新 push。
5. 重複 3-4 步,直到所有意見都被解決。
6. 項目維護者合併 Pull Request,並刪除原始分支。

每個 Pull Request 至少需要一個維護者的 Approve 才能被合併。

### 測試規範

我們編寫自動化測試來保證程式碼的品質,測試分為以下幾類:

- 單元測試:對函式或類的方法進行測試,保證其邏輯正確。
- 整合測試:對多個單元組合後的功能進行測試,保證各個單元之間協作正確。
- 端到端測試:從使用者的角度,對整個系統的功能進行測試,保證系統可以正常工作。

測試程式碼需要遵循以下規範:

- 測試檔案名稱以 `.test.js` 或 `.spec.js` 結尾。
- 測試函式名稱表達測試的目的,以 `it` 或 `test` 開頭。
- 每個測試檔案只測試一個源碼檔案,檔名與源碼檔案名稱對應。
- 每個測試函式只測試一種情況,不要在一個測試函式中測試多種情況。
- 測試時要保證測試環境的獨立性,不要依賴外部環境的狀態。
- 測試要覆蓋所有邊界條件和異常情況。

我們要求單元測試的程式碼覆蓋率達到 80% 以上。 

## 部署流程

本節介紹如何將專案部署到生產環境,分為以下幾個步驟:

### 構建前端應用

1. 確保已經安裝了 Node.js 和 npm。
2. 在專案根目錄下執行以下命令,安裝前端依賴項:
   
   ```bash
   npm install
   ```
3. 執行以下命令,構建前端應用:
   
   ```bash
   npm run build
   ```
4. 構建完成後,會在 `dist/` 目錄下生成前端的靜態檔案。

### 構建後端應用

1. 確保已經安裝了 PHP 和 Composer。
2. 在 `kiosk/` 目錄下執行以下命令,安裝後端依賴項:
   
   ```bash
   composer install
   ```
3. 複製 `kiosk/config.example.php` 檔案,重新命名為 `kiosk/config.php`,並修改其中的資料庫連線設定。

### 部署到生產環境

1. 將構建好的前端靜態檔案上傳到生產環境的 Web 伺服器,設定網站根目錄為 `dist/` 目錄。
2. 將後端程式碼上傳到生產環境的 PHP 應用伺服器,設定網站根目錄為 `kiosk/` 目錄。
3. 在生產環境的資料庫中執行資料庫遷移,創建所需的資料表:
   
   ```bash
   php kiosk/migrate.php
   ```
4. 啟動 Web 伺服器和 PHP 應用伺服器。

### 執行冒煙測試

部署完成後,需要進行一些基本的冒煙測試,確保系統可以正常工作:

1. 訪問前端頁面,檢查頁面是否正常顯示,資源是否正常載入。
2. 嘗試進行一些常見的操作,如註冊、登入、瀏覽商品、添加到購物車、下單等,檢查功能是否正常。
3. 檢查後台管理介面,嘗試進行一些常見的管理操作,如添加/修改/刪除商品,查看訂單,生成報表等。
4. 檢查錯誤日誌,確保沒有嚴重的錯誤或異常。

如果冒煙測試通過,說明系統已經成功部署到生產環境,可以正常使用了。如果發現問題,需要及時進行修復和回滾。 